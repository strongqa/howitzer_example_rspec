language: ruby
dist: bionic
sudo: required
# Bundler and ruby caching
cache:
 - bundler
 - directories:
   - "/home/travis/.rvm/"
rvm:
  - 3.0.2
apt:
  sources:
    - ubuntu-sdk-team
  packages:
    - gstreamer1.0-plugins-base
    - gstreamer1.0-tools
    - gstreamer1.0-x

before_install:
  - gem install bundler:2.2.22
install: bundle install --jobs=3 --retry=3

env:
  global:
    - ARTIFACTS_DEBUG=0
    - ARTIFACTS_REGION="eu-west-1"
    - ARTIFACTS_BUCKET="howitzer-example-travis"
    - CI_ARTIFACTS_PATH="https://s3-eu-west-1.amazonaws.com/howitzer-example-travis/$TRAVIS_REPO_SLUG/$TRAVIS_BUILD_NUMBER/$TRAVIS_JOB_NUMBER/"
    - MAILGUN_DOMAIN="mg.strongqa.com"
    - BASIC_SEXY_SETTINGS="mailgun_key=$MAILGUN_PRIVATE_API_KEY,mailgun_domain=$MAILGUN_DOMAIN"

  matrix:
    - DRIVER=headless_chrome SEXY_SETTINGS="$BASIC_SEXY_SETTINGS,driver=$DRIVER"
    - DRIVER=headless_firefox SEXY_SETTINGS="$BASIC_SEXY_SETTINGS,driver=$DRIVER"
    # - secure: "Fw+moqHkGSgR8dr0KMNxMbFjoX1yL7+94AinCcH/wPrbkgeBnP5k+pmVNfCJ8kMNR/mrGY20MrqSGLFmDriHCUwh5IPdMSXOcCAgJ/9nkh34sZGdKZTbSvU4XKi69qQxbbXccmbZnapC2uD95g42zw2EUDsUDS2qRmmxjRqAQajYg7QtWeE9dXjhytttiEu+6HrCE7qhTe3UMlqD29tHnUVrnfNDI2Ev5pEPkU7ADM+G3VM1VBLuMFW4JwRThaFBvCGvOU5Y7bSxOV6bLaz9+hq7ZomWroXZzJtc7gcUqqu8w4yZrH3V0DHx3DzUsJF/qYOx/AdQqjJuFZ7kSAZNhAGS8++J1QgvPaQpQVnrBTjWgxOgGyUDKu9J6ph2pY906IlI6BDveb7N6BOdNmCpHllWC706hssdNq1zIc6LDB3uXvRaSSIVh75t+KGfGLWGWSfldyr8Ry7OE7GY28uHMEI64BV1uI2L0bxKQ4DUYCZ+nz1nr4/Hu64MnMmQ/3bqkiev9p64KdGIyBL1NvjgiMvoUVCzDZZ4ppmO/rmon+cMQEY357SmxCp5tXkU5vtBbFXOOBdPnyDWYjvSiRKTldtYDfPwMjnbDteROB8N1lm1B0Xw+gs6M43UxI4Uc5zB97PuOMjgmrZoaTsb3faadLlg3gWKXaxQGn6bsMufRpI="
    # #SEXY_SETTINGS=driver=sauce,mailgun_api_key=secret,mailgun_key=secret,sl_user=secret,sl_api_key=secret,cloud_auth_login=secret,cloud_auth_pass=secret
    # - secure: "UjKaGlyPXF+kzIOBhmxlt4ZaBDh2Qh57FpZIjJo9ytn4b2uxxwnevsit6q+FOL3XycPVYqKHT8UBpFSVRDUKxkL9tgY8snnRO/iI+uKkn+BRSq+v8aXjfYdOGDHp/hcnNi7X94CIaQvhhjmlvFvUyGoSwm5yWthv7Hxz/xwHMmnDhQL/CFzTquRY7n9+UM+AXMNvhvmkfK/T8NyUkeksvqr3ks1ilqme3143iXXn9aCBc/1lGb8+89tgWcugfPlRXHQq0Vl+/TNVDfJViW8ZlPu2kgwu12RB2nJcLaeH4nT2tuA6KHpJzqsaCBv5qpsNCkmUnQuEUNKdysTmI1ipXHVxo93p0TJXBTa+Nf/uX5J2jSAQa3iQl+reAbTazvHdMprdm+WNd3OPQT7ExbGij239hF7FUTSFbpSHD1uSF7c0UAw5/FjOCUbaZFnRYM0lQeTJHqEOAt9GklRl+ubYW+W/zcHpj6lHu+GrE7PbxFCapzTZqAbZV8iablFsVqpb8EnMGIaIaXSRCIAmHHYxqthRi05Zy+WrfkhYsS63+aPDPVF8kRlR5TuivqyXJ7dksrgHSoa6+Na23SIoO3vAeM9x7zf1MKB5QY4lv73F1hDHMu2Kk3MOCPr3pIur9JB+vq0ZyYoiLJbphez1TNgYEMWl1+7tCnAtXArWigdWHVY="
    # #SEXY_SETTINGS=driver=testingbot,mailgun_api_key=secret,mailgun_key=secret,cloud_auth_login=secret,cloud_auth_pass=secret
    # - secure: "cvHnP1ZrIMpOgmyHsC8sOIsH28bOtgcZUP9K6yI4pe7UfMtQg4XX77v6n63pT+W+X+JelSd+UPgtJCFZ7boASO8uQ0mnI7sS8JfiMF1xzYakUG00z9K+3u+YY6lB8Lq9p5aIqRlDz0tDNcXBtFjTr4Awz3NohmXulXdBwJawMmLhjeTBsjGK9cvmv8QeVBQHsGdvGHOI7T/SZwAppILPaUmvEJuR4ykoTN0MF6l/+ZsxPv5KsegScKMNGGdvhrypOtZdrmujGEKL5j7xusBcOVJrJd+ehymXNx81CV1Q34nTCpBxhGKPW/0BytLTZDrknqc1T9nQAf+G7dXmTQ4+1ETuuwTemJ+yevT62V63aIpZqX38lQK0kqn82Q1XyqO5kBZ40SYchoJ/OUJGs82BVtEdLO6NYd0ZQZM1HpuMTQ3HPkrIsnJH7rn9/QFKanXLbm5gS40BllPPCZQl1OxsHGdxEXRYcDP5abBpOf+TVaVPZ3q3zIP4axtCeQO0MiJCc/y+9OM6z/21sL629H4Ql04/Krt3ycazwZ8xM9lStkA9cvT8w8PovdlxR99uZuxJ44/JLTphOJcFgj+/ixV6jThzAHY3XbFdPMGfNbAT+YH0XsUUdU1M67yd6n+/p9HXwOC7trN7gwU0DHn8Xo0RQZv5GGgcDUrCKbeUS1FnecA="
    # #SEXY_SETTINGS=driver=browserstack,mailgun_api_key=secret,mailgun_key=secret,cloud_auth_login=secret,cloud_auth_pass=secret
    # - secure: "ZmF9ECUM8MjXnvUu9umsikz/RyLNbMpDtvXhtc/llVevE5LqMeSUUqjm5OEAL96j5+fKb0tg8xCZIdf3j93u+VUPEsKWd33uAgsLEY/DPws3t15FbL1FyCEkxemlDQ3KGGgIopa5GRKfq3Y0Ftx78zwYfC8Fx3xfz1/Rwy0e94hKNdl3ooi25NsTfC0F+wQKkE8h09ZHadSmLIt58qh5PH34s3wb5FZekT0TN+xJYDfvXi8iRYaOk4bxR/UxXUVpTtBGQ5W/BuUQ7MlTSHg3CfdJd2rsRzDWFlQ1bFbmaPSKLhyzPY/dPUQ1sbuxd1a4aPUFBRZviRKuYL2XbBi9r1GBhuvHHImL3CELRlZqe5qONKjjjfk8rft7lBwTbEbW9Cxp/G9qN5dvsB4KZ2WC1uIrVtZKG+jCR7ZA0nzN7x4yMG06cG+um61Luhr4aI3nODWy6bRSuvzrAS8fSH3voRf68USCyfFUwN8dwGPzufZqWRFkIjgg48RdWz57ivxPZ3WZ3/vrxgFuMFCjBIToIWCcA02aDoJBC+agRlq5OKiE/KNciT2oUSEiWzEeRxKUvswDgFPAGMiDJTB7IJ84+Su779cN3AfB0hOBQb3tVNFGejoh64T3tPLuMS4tSKmY/DCpm/HFp+VaqoNxDORerlsf9iex7pr92faaSjvA1dQ="
    # #SEXY_SETTINGS=driver=crossbrowsertesting,mailgun_api_key=secret,mailgun_key=secret,cloud_auth_login=secret,cloud_auth_pass=secret


addons:
  chrome: stable
  firefox: latest
  artifacts:
    paths:
      - $(find log -type f | tr "\n" ":")

script: "./scripts/run-tests.sh"
